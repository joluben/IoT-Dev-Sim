<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <title>DevSim - Simulador de se√±ales de dispositivos</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Font Awesome for pagination chevrons and spinner icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    
</head>
<body>
    <div class="app-shell">
        <aside class="sidebar">
            <div class="sidebar-content">
                <div class="logo">
                    <div class="logo-text">
                        <h1>Device Simulator</h1>
                        <p>Simulador de se√±ales IoT</p>
                    </div>
                </div>
                <nav class="sidebar-nav">
                    <button id="nav-projects" class="nav-btn" data-i18n="common.navigation.projects">Proyectos</button>
                    <button id="nav-devices" class="nav-btn active" data-i18n="common.navigation.devices">Dispositivos</button>
                    <button id="nav-connections" class="nav-btn" data-i18n="common.navigation.connections">Conexiones</button>
                </nav>
            </div>
            
            <!-- User Authentication Section -->
            <div class="auth-section" id="auth-section" style="display: none;">
                <div class="user-info" id="user-info">
                    <!-- User info will be populated by keycloak-auth.js -->
                </div>
                <button id="logout-button" class="logout-button btn btn-secondary" style="display: none;">
                    <span data-i18n="common.auth.logout">Salir</span>
                </button>
            </div>
            
            <!-- Selector de Idioma -->
            <div class="language-selector">
                <button id="language-selector" class="language-btn" title="Cambiar idioma" data-i18n-title="common.language.switch_to">
                    üåê <span data-i18n="common.language.current">Espa√±ol</span>
                </button>
            </div>
        </aside>

        <main class="main-content">
            <div class="container">

        <!-- Vista: Lista de Dispositivos -->
        <div id="devices-list-view" class="view active">
            <div class="view-header">
                <h2 data-i18n="devices.title">Dispositivos</h2>
                <button id="btn-new-device" class="btn btn-primary" data-i18n="devices.create_device">Nuevo Dispositivo</button>
            </div>
            
            <div class="devices-grid" id="devices-grid">
                <div class="loading" id="devices-loading">Cargando dispositivos...</div>
            </div>
            
            <!-- Pagination for devices -->
            <div id="devices-pagination"></div>
        </div>

        <!-- Vista: Crear Dispositivo -->
        <div id="create-device-view" class="view">
            <div class="view-header">
                <h2 data-i18n="devices.create_device">Crear Dispositivo</h2>
                <button id="btn-back-to-list" class="btn btn-secondary" data-i18n="common.actions.back">Volver</button>
            </div>
            
            <form id="create-device-form" class="form">
                <div class="form-group">
                    <label for="device-name" data-i18n="common.common.name">Nombre *</label>
                    <input type="text" id="device-name" name="name" required data-i18n-placeholder="devices.device_form.name">
                </div>
                
                <div class="form-group">
                    <label for="device-description" data-i18n="common.common.description">Descripci√≥n</label>
                    <textarea id="device-description" name="description" rows="3" data-i18n-placeholder="devices.device_form.description"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" data-i18n="devices.create_device">Crear Dispositivo</button>
                    <button type="button" id="btn-cancel-create" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Vista: Detalle Dispositivo -->
        <div id="device-detail-view" class="view">
            <div class="app-container">
                <!-- Header compacto -->
                <section class="header-section">
                    <div class="header-content">
                        <div class="device-title-area">
                            <h1 class="device-title" id="device-detail-title">Dispositivo</h1>
                            <span class="device-reference" id="device-reference">REF</span>
                            <div class="device-status-badge" id="device-status-badge">
                                <div class="status-dot"></div>
                                <span id="device-status-text">Estado</span>
                            </div>
                        </div>
                        <button id="btn-back-from-detail" class="btn btn-secondary" data-i18n="common.actions.back">
                            ‚Üê Volver
                        </button>
                    </div>
                </section>

                <!-- Grid principal -->
                <div class="main-grid">
                    <!-- Panel de informaci√≥n -->
                    <div class="info-panel">
                        <h3 class="panel-title" data-i18n="devices.sections.info">
                            üìã Informaci√≥n del Dispositivo
                        </h3>
                        <div class="info-grid" id="device-info">
                            <!-- Info del dispositivo se carga din√°micamente -->
                        </div>
                    </div>

                    <!-- Panel de upload -->
                    <div class="upload-panel">
                        <h3 class="panel-title" data-i18n="devices.sections.import_csv">
                            üìÅ Importar CSV
                        </h3>
                        <div class="upload-area" id="upload-area">
                            <div class="upload-icon">üìÑ</div>
                            <p class="upload-text">
                                <span data-i18n="devices.upload.drag">Arrastra tu archivo CSV aqu√≠ o</span> 
                                <span class="upload-link" data-i18n="devices.upload.select_file">selecciona un archivo</span>
                            </p>
                            <input type="file" id="csv-file-input" accept=".csv" hidden>
                        </div>
                    </div>
                </div>

                <!-- Configuraci√≥n de transmisi√≥n -->
                <section class="transmission-section" id="transmission-section">
                    <div class="transmission-header">
                        <h3 class="panel-title" data-i18n="devices.sections.transmission">
                            üì° Configuraci√≥n de Transmisi√≥n
                        </h3>
                        <div class="transmission-status-compact">
                            <div class="status-indicator-container">
                                <div id="transmission-state-indicator" class="transmission-indicator state-inactive"></div>
                                <span id="transmission-state-text" class="state-text" data-i18n="devices.status.inactive">Inactivo</span>
                            </div>
                        </div>
                    </div>

                    <!-- Controles del sensor -->
                    <div class="sensor-controls" id="sensor-controls" style="display: none;">
                        <div class="current-position">
                            <span class="position-info">
                                <span data-i18n="devices.sensor.current_position">Posici√≥n actual:</span> <span class="position-value" id="current-row-index">0</span>
                            </span>
                            <button id="btn-reset-sensor" class="btn btn-warning btn-sm" data-i18n="devices.sensor.reset_position">
                                üîÑ Reiniciar Posici√≥n
                            </button>
                        </div>
                    </div>

                    <!-- Grid de configuraci√≥n -->
                    <div class="config-grid">
                        <div class="form-group">
                            <label data-i18n="devices.device_form.device_type">Tipo de Dispositivo</label>
                            <select id="device-type" name="device_type">
                                <option value="WebApp">üì± WebApp (Env√≠o completo)</option>
                                <option value="Sensor">üî¨ Sensor (Fila por fila)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label data-i18n="devices.device_form.transmission_frequency">Frecuencia (segundos)</label>
                            <input type="number" id="transmission-frequency" name="transmission_frequency" min="1" value="3600">
                        </div>

                        <div class="form-group">
                            <label data-i18n="devices.labels.connection_for_transmission">Conexi√≥n para Transmisi√≥n</label>
                            <select id="transmission-connection" name="transmission_connection">
                                <option value="" data-i18n="devices.select.connection_placeholder">Seleccionar conexi√≥n...</option>
                            </select>
                        </div>

                        <div class="checkbox-container">
                            <label class="checkbox-label">
                                <input type="checkbox" id="transmission-enabled" name="transmission_enabled">
                                <span data-i18n="devices.labels.auto_transmission_enabled">Transmisi√≥n autom√°tica habilitada</span>
                            </label>
                            <label class="checkbox-label" id="auto-reset-counter-container" style="display: none;">
                                <input type="checkbox" id="auto-reset-counter" name="auto_reset_counter">
                                <span data-i18n="devices.labels.auto_reset_counter">Reiniciar contador autom√°ticamente al completar datos</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="include-device-id" name="include_device_id_in_payload">
                                <span data-i18n="devices.labels.include_device_id">Incluir device_id en payload</span>
                            </label>
                        </div>
                    </div>

                    <!-- Botones de acci√≥n -->
                    <div class="action-buttons">
                        <button id="btn-save-transmission-config" class="btn btn-primary" data-i18n="devices.actions.save_config">
                            üíæ Guardar Configuraci√≥n
                        </button>
                        <button id="btn-transmit-now" class="btn btn-success" data-i18n="devices.actions.transmit_now">
                            üì§ Transmitir Ahora
                        </button>
                        <button id="btn-pause-transmission" class="btn btn-warning" style="display: none;" data-i18n="devices.actions.pause_transmission">
                            ‚è∏Ô∏è Pausar
                        </button>
                        <button id="btn-resume-transmission" class="btn btn-info" style="display: none;" data-i18n="devices.actions.resume_transmission">
                            ‚ñ∂Ô∏è Reanudar
                        </button>
                        <button id="btn-stop-transmission" class="btn btn-danger" disabled data-i18n="devices.actions.stop_transmission">
                            ‚èπÔ∏è Parar
                        </button>
                    </div>
                </section>

                <!-- Historial de transmisiones -->
                <section class="history-section">
                    <div class="transmission-header">
                        <h3 class="panel-title" data-i18n="devices.sections.transmission_history">
                            üìã Historial de Transmisiones
                        </h3>
                        <div class="history-controls">
                            <select id="history-filter-status" class="filter-select">
                                <option value="" data-i18n="devices.history.filters.all_status">Todos los estados</option>
                                <option value="SUCCESS" data-i18n="devices.history.filters.success">Exitosas</option>
                                <option value="FAILED" data-i18n="devices.history.filters.failed">Fallidas</option>
                            </select>
                            <select id="history-filter-connection" class="filter-select">
                                <option value="" data-i18n="devices.history.filters.all_connections">Todas las conexiones</option>
                            </select>
                            <button class="btn btn-sm btn-secondary" onclick="exportTransmissionHistory()" data-i18n="common.actions.export">
                                üì• Exportar
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="refreshTransmissionHistory()" data-i18n="devices.history.actions.refresh">
                                üîÑ Actualizar
                            </button>
                        </div>
                    </div>
                    <div id="transmission-history-list" class="history-list">
                        <div class="empty-state">Sin transmisiones</div>
                    </div>
                    <div class="history-pagination" id="history-pagination" style="display: none;">
                        <button class="btn btn-sm" onclick="loadHistoryPage('prev')" data-i18n="common.pagination.prev">‚Üê Anterior</button>
                        <span id="history-page-info" data-i18n="devices.history.page_info">P√°gina 1</span>
                        <button class="btn btn-sm" onclick="loadHistoryPage('next')" data-i18n="common.pagination.next">Siguiente ‚Üí</button>
                    </div>
                </section>

                <!-- Preview mejorado -->
                <section class="preview-section" id="preview-section" style="display: none;">
                    <h3 class="panel-title" data-i18n="devices.preview.title">
                        üëÅÔ∏è Previsualizaci√≥n
                    </h3>
                    
                    <div class="preview-tabs">
                        <button class="preview-tab active" data-tab="csv" data-i18n="devices.preview.csv">Vista CSV</button>
                        <button class="preview-tab" data-tab="json" data-i18n="devices.preview.json">Vista JSON</button>
                    </div>

                    <div class="preview-content" id="preview-content">
                        <div class="table-container">
                            <table id="csv-preview-table" class="preview-table">
                                <!-- Tabla CSV se genera din√°micamente -->
                            </table>
                        </div>
                    </div>

                    <div class="preview-actions">
                        <button id="btn-cancel-upload" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                        <button id="btn-save-csv" class="btn btn-primary" data-i18n="devices.preview.save_data">Guardar Datos</button>
                        <button id="btn-send-data" class="btn btn-success" style="display: none;" data-i18n="devices.preview.send_to_connection">
                            üì§ Enviar a Conexi√≥n
                        </button>
                    </div>
                </section>
            </div>
        </div>

        <!-- Vista: Lista de Conexiones -->
        <div id="connections-list-view" class="view">
            <div class="view-header">
                <h2 data-i18n="connections.title">üîó Conexiones Externas</h2>
                <button id="btn-new-connection" class="btn btn-primary" data-i18n="connections.create_connection">Nueva Conexi√≥n</button>
            </div>
            
            <div class="connections-grid" id="connections-grid">
                <div class="loading" id="connections-loading" data-i18n="connections.messages.loading_connections">Cargando conexiones...</div>
            </div>
            
            <!-- Pagination for connections -->
            <div id="connections-pagination"></div>
        </div>

        <!-- Vista: Crear/Editar Conexi√≥n -->
        <div id="connection-form-view" class="view">
            <!-- Header compacto -->
            <section class="connection-header-section">
                <div class="connection-header-content">
                    <h1 class="connection-form-title" id="connection-form-title" data-i18n="connections.create_connection">
                        üîå Nueva Conexi√≥n
                    </h1>
                    <button id="btn-back-to-connections" class="btn btn-secondary" data-i18n="common.actions.back">
                        ‚Üê Volver
                    </button>
                </div>
            </section>

            <!-- Formulario principal -->
            <div class="connection-form-container">
                <form id="connection-form" class="connection-form-grid">
                    <!-- Informaci√≥n b√°sica -->
                    <section class="connection-form-section">
                        <h3 class="connection-section-title" data-i18n="connections.sections.basic_info">
                            üìù Informaci√≥n B√°sica
                        </h3>
                        <div class="connection-fields-grid">
                            <div class="form-group">
                                <label for="connection-name" data-i18n="common.common.name">
                                    Nombre <span class="required">*</span>
                                </label>
                                <input type="text" id="connection-name" name="name" placeholder="Mi conexi√≥n MQTT" required data-i18n-placeholder="connections.connection_form.name">
                            </div>
                            <div class="form-group">
                                <label for="connection-type" data-i18n="connections.connection_form.connection_type">
                                    Tipo de Conexi√≥n <span class="required">*</span>
                                </label>
                                <select id="connection-type" name="type" required>
                                    <option value="" data-i18n="connections.select.type_placeholder">Seleccionar tipo...</option>
                                    <option value="MQTT">üìÑ MQTT (Mosquitto)</option>
                                    <option value="HTTPS">üåê HTTPS/HTTP REST API</option>
                                    <option value="KAFKA">üîµ Kafka</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label for="connection-description" data-i18n="common.common.description">Descripci√≥n</label>
                                <textarea id="connection-description" name="description" rows="2" placeholder="Descripci√≥n opcional de la conexi√≥n" data-i18n-placeholder="connections.connection_form.description"></textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Configuraci√≥n del servidor -->
                    <section class="connection-form-section">
                        <h3 class="connection-section-title" data-i18n="connections.sections.server_config">
                            üåê Configuraci√≥n de Servidor
                        </h3>
                        <div class="connection-fields-grid">
                            <div class="form-group">
                                <label for="connection-host" data-i18n="connections.labels.host">
                                    Host/Servidor <span class="required">*</span>
                                </label>
                                <input type="text" id="connection-host" name="host" placeholder="ejemplo.com" required data-i18n-placeholder="connections.placeholders.host">
                            </div>
                            <div class="form-group">
                                <label for="connection-port" data-i18n="connections.labels.port">Puerto</label>
                                <input type="number" id="connection-port" name="port" placeholder="1883" data-i18n-placeholder="connections.placeholders.port">
                            </div>
                            <div class="form-group full-width">
                                <label for="connection-endpoint" data-i18n="connections.labels.endpoint">Endpoint/Topic</label>
                                <input type="text" id="connection-endpoint" name="endpoint" placeholder="/api/data o devices/topic" data-i18n-placeholder="connections.placeholders.endpoint">
                                <small class="form-help">
                                    Para HTTPS: ruta del endpoint. Para MQTT: topic de destino
                                </small>
                            </div>
                            <!-- HTTP/HTTPS options -->
                            <div class="checkbox-container">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="connection-ssl" name="ssl" checked>
                                    <span>Usar HTTPS (SSL)</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="connection-verify-ssl" name="verify_ssl" checked>
                                    <span>Verificar certificado SSL</span>
                                </label>
                                <small class="form-help">Desmarca para pruebas con certificados autofirmados</small>
                            </div>
                        </div>
                    </section>

                    <!-- Autenticaci√≥n -->
                    <section class="connection-form-section">
                        <h3 class="connection-section-title" data-i18n="connections.sections.authentication">
                            üîê Autenticaci√≥n
                        </h3>
                        <div class="connection-fields-grid single-column">
                            <div class="form-group">
                                <label for="auth-type" data-i18n="connections.connection_form.auth_type">
                                    Tipo de Autenticaci√≥n <span class="required">*</span>
                                </label>
                                <select id="auth-type" name="auth_type" required>
                                    <option value="NONE" data-i18n="connections.auth_types.none">üîì Sin Autenticaci√≥n</option>
                                    <option value="USER_PASS" data-i18n="connections.auth_types.user_pass">üë§ Usuario y Contrase√±a</option>
                                    <option value="TOKEN" data-i18n="connections.auth_types.token">üé´ Token Bearer</option>
                                    <option value="API_KEY" data-i18n="connections.auth_types.api_key">üîë API Key</option>
                                </select>
                            </div>
                        </div>

                        <!-- Campos din√°micos de autenticaci√≥n -->
                        <div class="connection-auth-fields hidden" id="auth-user-pass">
                            <div class="connection-fields-grid">
                                <div class="form-group">
                                    <label for="auth-username" data-i18n="connections.connection_form.username">Usuario</label>
                                    <input type="text" id="auth-username" name="username" placeholder="nombre_usuario" data-i18n-placeholder="connections.placeholders.username">
                                </div>
                                <div class="form-group">
                                    <label for="auth-password" data-i18n="connections.connection_form.password">Contrase√±a</label>
                                    <input type="password" id="auth-password" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" data-i18n-placeholder="connections.placeholders.password">
                                </div>
                            </div>
                        </div>

                        <div class="connection-auth-fields hidden" id="auth-token">
                            <div class="form-group">
                                <label for="auth-token-value" data-i18n="connections.connection_form.token">Token Bearer</label>
                                <input type="password" id="auth-token-value" name="token" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." data-i18n-placeholder="connections.placeholders.token">
                                <small class="form-help">
                                    Token que se enviar√° en el header Authorization: Bearer
                                </small>
                            </div>
                        </div>

                        <div class="connection-auth-fields hidden" id="auth-api-key">
                            <div class="connection-fields-grid">
                                <div class="form-group">
                                    <label for="api-key-header" data-i18n="connections.labels.api_key_header">Nombre del Header</label>
                                    <input type="text" id="api-key-header" name="api_key_header" placeholder="X-API-Key" value="X-API-Key" data-i18n-placeholder="connections.placeholders.api_key_header">
                                </div>
                                <div class="form-group">
                                    <label for="api-key-value" data-i18n="connections.connection_form.api_key">API Key</label>
                                    <input type="password" id="api-key-value" name="api_key" placeholder="tu_api_key_aqui" data-i18n-placeholder="connections.placeholders.api_key">
                                </div>
                            </div>
                        </div>

                        <!-- Configuraci√≥n avanzada -->
                        <button type="button" class="connection-advanced-toggle" id="toggle-advanced" data-i18n="connections.sections.advanced">
                            ‚öôÔ∏è Configuraci√≥n avanzada
                            <span class="toggle-icon">‚ñº</span>
                        </button>

                        <div class="connection-advanced-content hidden" id="advanced-config">
                            <div class="connection-fields-grid">
                                <div class="form-group">
                                    <label for="connection-timeout" data-i18n="connections.labels.timeout">Timeout (segundos)</label>
                                    <input type="number" id="connection-timeout" name="timeout" placeholder="30" value="30" data-i18n-placeholder="connections.placeholders.timeout">
                                </div>
                                <div class="form-group">
                                    <label for="connection-retries" data-i18n="connections.labels.retries">Reintentos</label>
                                    <input type="number" id="connection-retries" name="retries" placeholder="3" value="3" data-i18n-placeholder="connections.placeholders.retries">
                                </div>
                                <div class="form-group full-width">
                                    <label for="connection-headers" data-i18n="connections.labels.additional_headers">Headers adicionales</label>
                                    <textarea id="connection-headers" name="additional_headers" rows="2" placeholder='{"Content-Type": "application/json"}' data-i18n-placeholder="connections.placeholders.additional_headers"></textarea>
                                    <small class="form-help">
                                        JSON con headers adicionales (opcional)
                                    </small>
                                </div>
                            </div>
                            <!-- Dynamic advanced fields container injected by showAdvancedFields() -->
                            <div id="advanced-fields"></div>
                        </div>
                    </section>

                    <!-- Vista previa de configuraci√≥n -->
                    <section class="connection-form-section">
                        <h3 class="connection-section-title" data-i18n="connections.preview.title">
                            üëÅÔ∏è Vista Previa
                        </h3>
                        <div class="connection-config-preview">
                            <div class="connection-config-preview-title" data-i18n="connections.preview.generated_config">Configuraci√≥n generada:</div>
                            <div class="connection-config-preview-content" id="config-preview">
{
  "name": "",
  "type": "",
  "host": "",
  "port": null,
  "endpoint": "",
  "auth_type": "NONE",
  "timeout": 30,
  "retries": 3
}
                            </div>
                        </div>
                    </section>

                    <!-- Estado de la prueba de conexi√≥n -->
                    <div id="connection-test-result"></div>
                </form>
            </div>

            <!-- Acciones del formulario -->
            <div class="connection-form-actions">
                <button type="button" id="btn-cancel-connection" class="btn btn-secondary" data-i18n="common.actions.cancel">
                    Cancelar
                </button>
                <button type="button" id="btn-test-connection" class="btn btn-info" disabled data-i18n="connections.actions.test_connection">
                    üß™ Probar Conexi√≥n
                </button>
                <button type="submit" form="connection-form" class="btn btn-primary">
                    <span id="connection-submit-text" data-i18n="connections.create_connection">üíæ Crear Conexi√≥n</span>
                </button>
            </div>
        </div>

        <!-- Vista: Detalle de Conexi√≥n -->
        <div id="connection-detail-view" class="view">
            <div class="view-header">
                <h2 id="connection-detail-title" data-i18n="connections.connection_details">Detalle de Conexi√≥n</h2>
                <div class="header-actions">
                    <button id="btn-edit-connection" class="btn btn-info" data-i18n="common.actions.edit">‚úèÔ∏è Editar</button>
                    <button id="btn-test-connection-detail" class="btn btn-success" data-i18n="connections.actions.test_connection">üß™ Probar</button>
                    <button id="btn-back-from-connection-detail" class="btn btn-secondary" data-i18n="common.actions.back">Volver</button>
                </div>
            </div>
            
            <div class="connection-info" id="connection-info">
                <!-- Info de la conexi√≥n se carga din√°micamente -->
            </div>
            
            <div class="connection-history">
                <h3 data-i18n="connections.history.title">üìä Historial de Pruebas</h3>
                <div class="history-list" id="connection-history-list">
                    <div class="loading" data-i18n="connections.history.loading">Cargando historial...</div>
                </div>
            </div>
        </div>

        <!-- Vista: Lista de Proyectos -->
        <div id="projects-list-view" class="view">
            <div class="view-header">
                <h2 data-i18n="projects.title">üìÅ Proyectos</h2>
                <button id="btn-new-project" class="btn btn-primary" data-i18n="projects.create_project">Nuevo Proyecto</button>
            </div>
            
            <div class="projects-grid" id="projects-grid">
                <div class="loading" id="projects-loading" data-i18n="projects.messages.loading_projects">Cargando proyectos...</div>
            </div>
            
            <!-- Pagination for projects -->
            <div id="projects-pagination"></div>
        </div>

        <!-- Vista: Crear/Editar Proyecto -->
        <div id="project-form-view" class="view">
            <div class="view-header">
                <h2 id="project-form-title" data-i18n="projects.create_project">Nuevo Proyecto</h2>
                <button id="btn-back-to-projects" class="btn btn-secondary" data-i18n="common.actions.back">Volver</button>
            </div>
            
            <form id="project-form" class="form">
                <div class="form-group">
                    <label for="project-name" data-i18n="projects.project_form.name">Nombre del Proyecto *</label>
                    <input type="text" id="project-name" name="name" required data-i18n-placeholder="projects.project_form.name">
                </div>
                
                <div class="form-group">
                    <label for="project-description" data-i18n="common.common.description">Descripci√≥n</label>
                    <textarea id="project-description" name="description" rows="3" data-i18n-placeholder="projects.project_form.description"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <span id="project-submit-text" data-i18n="projects.create_project">Crear Proyecto</span>
                    </button>
                    <button type="button" id="btn-cancel-project" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </form>
        </div>

        <!-- Vista: Detalle de Proyecto -->
        <div id="project-detail-view" class="view">
            <div class="app-container">
                <!-- Header del proyecto -->
                <section class="header-section">
                    <div class="header-content">
                        <div class="project-title-area">
                            <h1 class="project-title" id="project-detail-title" data-i18n="projects.project_details">Detalle de Proyecto</h1>
                            <div class="project-metadata">
                                <div class="project-status active" id="project-status-badge" data-i18n="common.status.active">Activo</div>
                                <div class="project-stats" id="project-stats">
                                    <div class="stat-item">
                                        <span data-i18n="projects.labels.devices">üì± Dispositivos:</span>
                                        <span class="stat-value" id="project-devices-count">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span data-i18n="projects.labels.transmissions">üì° Transmisiones:</span>
                                        <span class="stat-value" id="project-transmissions-count">0</span>
                                    </div>
                                    <div class="stat-item">
                                        <span data-i18n="projects.labels.success">‚úÖ √âxito:</span>
                                        <span class="stat-value" id="project-success-rate">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button id="btn-edit-project" class="btn btn-info" data-i18n="common.actions.edit">
                                ‚úèÔ∏è Editar
                            </button>
                            <button id="btn-delete-project" class="btn btn-danger" data-i18n="common.actions.delete">
                                üóëÔ∏è Eliminar
                            </button>
                            <button id="btn-back-from-project-detail" class="btn btn-secondary" data-i18n="common.actions.back">
                                ‚Üê Volver
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Grid principal -->
                <div class="main-grid">
                    <!-- Panel de informaci√≥n del proyecto -->
                    <div class="info-panel">
                        <h3 class="panel-title" data-i18n="projects.sections.info">
                            üìã Informaci√≥n del Proyecto
                        </h3>
                        <div class="info-grid" id="project-info">
                            <!-- Info del proyecto se carga din√°micamente -->
                        </div>
                    </div>

                    <!-- Control de transmisiones -->
                    <div class="transmission-control">
                        <h3 class="panel-title" data-i18n="projects.sections.transmission_control">
                            üì° Control de Transmisiones
                        </h3>
                        
                        <div class="transmission-status-compact">
                            <div class="status-indicator-container">
                                <div id="project-transmission-indicator" class="transmission-indicator state-inactive"></div>
                                <span id="project-transmission-text" class="state-text" data-i18n="projects.status.inactive">Transmisiones inactivas</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Conexi√≥n para Transmisi√≥n</label>
                            <select id="project-connection-selector" name="connection_id">
                                <option value="" data-i18n="projects.select.use_device_connection">Usar conexi√≥n de cada dispositivo</option>
                            </select>
                        </div>

                        <div class="checkbox-container">
                            <label class="checkbox-label">
                                <input type="checkbox" id="project-auto-reset-counter" name="auto_reset_counter">
                                <span data-i18n="projects.labels.auto_reset_counter">Reiniciar contador al completar los datos</span>
                            </label>
                        </div>

                        <div class="transmission-actions">
                            <button id="btn-start-project-transmission" class="btn btn-success" data-i18n="projects.actions.start_transmissions">
                                üöÄ Iniciar Transmisiones
                            </button>
                            <button id="btn-pause-project-transmission" class="btn btn-warning" style="display: none;" data-i18n="projects.actions.pause">
                                ‚è∏Ô∏è Pausar
                            </button>
                            <button id="btn-resume-project-transmission" class="btn btn-info" style="display: none;" data-i18n="projects.actions.resume">
                                ‚ñ∂Ô∏è Reanudar
                            </button>
                            <button id="btn-stop-project-transmission" class="btn btn-danger" data-i18n="projects.actions.stop">
                                ‚èπÔ∏è Parar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n de dispositivos -->
                <section class="devices-section">
                    <div class="devices-header">
                        <h3 class="panel-title" data-i18n="projects.sections.devices">
                            üì± Dispositivos del Proyecto
                        </h3>
                        <button id="btn-add-devices-to-project" class="btn btn-primary btn-medium" data-i18n="projects.actions.add_devices">
                            ‚ûï Agregar Dispositivos
                        </button>
                    </div>
                    
                    <div class="devices-grid" id="project-devices-list">
                        <div class="loading">Cargando dispositivos...</div>
                    </div>
                </section>

                <!-- Historial de transmisiones -->
                <section class="history-section">
                    <div class="history-header">
                        <h3 class="panel-title">
                            üìã Historial de Transmisiones
                        </h3>
                        <div class="history-controls">
                            <select id="project-history-filter-device" class="filter-select">
                                <option value="">Todos los dispositivos</option>
                            </select>
                            <select id="project-history-filter-status" class="filter-select">
                                <option value="" data-i18n="projects.history.filters.all_status">Todos los estados</option>
                                <option value="SUCCESS" data-i18n="projects.history.filters.success">Exitosas</option>
                                <option value="FAILED" data-i18n="projects.history.filters.failed">Fallidas</option>
                            </select>
                            <button class="btn btn-sm btn-secondary" onclick="exportProjectTransmissionHistory()" data-i18n="common.actions.export">
                                üì• Exportar
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="refreshProjectTransmissionHistory()" data-i18n="projects.history.actions.refresh">
                                üîÑ Actualizar
                            </button>
                        </div>
                    </div>
                    <div id="project-transmission-history-list" class="history-list">
                        <div class="empty-state">Sin transmisiones registradas</div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Modal de Env√≠o de Datos -->
        <div id="send-data-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="devices.modals.send_data.title">üì§ Enviar Datos del Dispositivo</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p data-i18n="devices.modals.send_data.select_connection">Selecciona una conexi√≥n para enviar los datos:</p>
                    <div class="connections-selector" id="connections-selector">
                        <!-- Lista de conexiones activas -->
                    </div>
                    <div class="data-preview">
                        <h4 data-i18n="devices.modals.send_data.preview_title">Vista previa de los datos:</h4>
                        <pre id="send-data-preview"></pre>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-send" class="btn btn-primary" data-i18n="common.actions.confirm">Enviar</button>
                    <button id="btn-cancel-send" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Transmisi√≥n Manual -->
        <div id="transmit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="devices.modals.manual_transmission.title">üì° Transmisi√≥n Manual</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p data-i18n="devices.modals.manual_transmission.select_connection">Selecciona una conexi√≥n para la transmisi√≥n:</p>
                    <div class="connections-selector" id="transmit-connections-selector">
                        <!-- Lista de conexiones activas -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-transmit" class="btn btn-primary" data-i18n="devices.actions.transmit_now">Transmitir</button>
                    <button id="btn-cancel-transmit" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Selecci√≥n de Dispositivos para Proyecto -->
        <div id="add-devices-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="projects.modals.add_devices.title">‚ûï Agregar Dispositivos al Proyecto</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p data-i18n="projects.modals.add_devices.select_devices">Selecciona los dispositivos que deseas agregar al proyecto:</p>
                    <div class="devices-selector" id="unassigned-devices-selector">
                        <!-- Lista de dispositivos sin asignar -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-add-devices" class="btn btn-primary" data-i18n="projects.modals.add_devices.confirm">Agregar Seleccionados</button>
                    <button id="btn-cancel-add-devices" class="btn btn-secondary" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Duplicaci√≥n de Dispositivos -->
        <div id="duplicate-device-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="devices.duplicate.title">üîÑ Duplicar Dispositivo</h3>
                    <button class="modal-close" onclick="hideDuplicateModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p data-i18n="devices.duplicate.question">¬øCu√°ntas copias deseas crear de "<span id="device-name-to-duplicate"></span>"?</p>
                    <div class="form-group">
                        <label for="duplicate-count" data-i18n="devices.duplicate.count_label">N√∫mero de duplicados:</label>
                        <input type="number" id="duplicate-count" min="1" max="50" value="1">
                    </div>
                    <div class="duplicate-preview">
                        <h4 data-i18n="devices.duplicate.preview_label">Vista previa de nombres:</h4>
                        <ul id="duplicate-names-preview"></ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-duplicate" class="btn btn-primary" data-i18n="devices.duplicate.confirm">Duplicar</button>
                    <button id="btn-cancel-duplicate" class="btn btn-secondary" onclick="hideDuplicateModal()" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Eliminaci√≥n de Dispositivos -->
        <div id="delete-device-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 data-i18n="devices.delete.title">üóëÔ∏è Eliminar Dispositivo</h3>
                    <button class="modal-close" onclick="hideDeleteModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p data-i18n="devices.delete.intro">Vas a eliminar el dispositivo "<span id="device-name-to-delete"></span>".</p>
                    <p><strong data-i18n="devices.delete.warning_strong">Esta acci√≥n es permanente y no se podr√° recuperar.</strong> <span data-i18n="devices.delete.confirm_question">¬øDeseas continuar?</span></p>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-delete" class="btn btn-danger" data-i18n="common.actions.delete">Eliminar</button>
                    <button id="btn-cancel-delete" class="btn btn-secondary" onclick="hideDeleteModal()" data-i18n="common.actions.cancel">Cancelar</button>
                </div>
            </div>
        </div>

        <!-- Modal de Resultados de Operaciones -->
        <div id="operation-results-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="operation-title" data-i18n="common.operations.result_title">Resultado de Operaci√≥n</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="operation-summary">
                        <!-- Resumen de la operaci√≥n -->
                    </div>
                    <div class="operation-details">
                        <!-- Detalles por dispositivo -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="hideOperationResultsModal()" data-i18n="common.actions.close">Cerrar</button>
                </div>
            </div>
        </div>

                    </div>
        </main>
    </div>

    <!-- Notificaciones -->
    <div id="notifications" class="notifications-container"></div>

    <script src="i18n.js"></script>
    <script src="pagination.js"></script>
    <script src="transmission-api.js"></script>
    <script src="realtime.js"></script>
    <script src="keycloak-auth.js"></script>
    <script src="script.js"></script>
</body>
</html>
